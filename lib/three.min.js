// Minimal Three.js stub for testing when CDN is unavailable
// This is a simplified version for demonstration purposes
// In production, use the full Three.js library

(function() {
    'use strict';
    
    window.THREE = window.THREE || {};
    
    // Basic Vector3
    THREE.Vector3 = function(x, y, z) {
        this.x = x || 0;
        this.y = y || 0;
        this.z = z || 0;
    };
    
    THREE.Vector3.prototype = {
        set: function(x, y, z) {
            this.x = x;
            this.y = y;
            this.z = z;
            return this;
        },
        copy: function(v) {
            this.x = v.x;
            this.y = v.y;
            this.z = v.z;
            return this;
        },
        add: function(v) {
            this.x += v.x;
            this.y += v.y;
            this.z += v.z;
            return this;
        },
        multiplyScalar: function(s) {
            this.x *= s;
            this.y *= s;
            this.z *= s;
            return this;
        },
        clone: function() {
            return new THREE.Vector3(this.x, this.y, this.z);
        }
    };
    
    // Basic Color
    THREE.Color = function(color) {
        this.r = 1;
        this.g = 1;
        this.b = 1;
        if (typeof color === 'number') {
            this.setHex(color);
        }
    };
    
    THREE.Color.prototype = {
        setHex: function(hex) {
            this.r = ((hex >> 16) & 255) / 255;
            this.g = ((hex >> 8) & 255) / 255;
            this.b = (hex & 255) / 255;
            return this;
        }
    };
    
    // Scene
    THREE.Scene = function() {
        this.children = [];
        this.background = null;
        this.fog = null;
    };
    
    THREE.Scene.prototype = {
        add: function(object) {
            this.children.push(object);
        },
        remove: function(object) {
            var index = this.children.indexOf(object);
            if (index !== -1) {
                this.children.splice(index, 1);
            }
        }
    };
    
    // Camera
    THREE.PerspectiveCamera = function(fov, aspect, near, far) {
        this.fov = fov;
        this.aspect = aspect;
        this.near = near;
        this.far = far;
        this.position = new THREE.Vector3();
        this.rotation = new THREE.Vector3();
    };
    
    THREE.PerspectiveCamera.prototype = {
        lookAt: function(v) {
            // Simplified
        },
        updateProjectionMatrix: function() {
            // Simplified
        }
    };
    
    // Geometry stubs
    THREE.BoxGeometry = function() { this.type = 'box'; };
    THREE.PlaneGeometry = function() { this.type = 'plane'; };
    THREE.ConeGeometry = function() { this.type = 'cone'; };
    THREE.SphereGeometry = function() { this.type = 'sphere'; };
    THREE.CylinderGeometry = function() { this.type = 'cylinder'; };
    
    // Material stubs
    THREE.MeshStandardMaterial = function(params) {
        Object.assign(this, params);
    };
    THREE.MeshBasicMaterial = function(params) {
        Object.assign(this, params);
    };
    
    // Mesh
    THREE.Mesh = function(geometry, material) {
        this.geometry = geometry;
        this.material = material;
        this.position = new THREE.Vector3();
        this.rotation = new THREE.Vector3();
        this.scale = new THREE.Vector3(1, 1, 1);
        this.userData = {};
        this.children = [];
        this.visible = true;
        this.castShadow = false;
        this.receiveShadow = false;
    };
    
    THREE.Mesh.prototype = {
        add: function(object) {
            this.children.push(object);
        }
    };
    
    // Group
    THREE.Group = function() {
        this.children = [];
        this.position = new THREE.Vector3();
        this.rotation = new THREE.Vector3();
        this.userData = {};
    };
    
    THREE.Group.prototype = {
        add: function(object) {
            this.children.push(object);
        }
    };
    
    // Lights
    THREE.DirectionalLight = function(color, intensity) {
        this.color = new THREE.Color(color);
        this.intensity = intensity;
        this.position = new THREE.Vector3();
        this.castShadow = false;
        this.shadow = { mapSize: { width: 0, height: 0 } };
    };
    
    THREE.AmbientLight = function(color, intensity) {
        this.color = new THREE.Color(color);
        this.intensity = intensity;
    };
    
    THREE.PointLight = function(color, intensity, distance) {
        this.color = new THREE.Color(color);
        this.intensity = intensity;
        this.distance = distance;
        this.position = new THREE.Vector3();
    };
    
    // Fog
    THREE.Fog = function(color, near, far) {
        this.color = new THREE.Color(color);
        this.near = near;
        this.far = far;
    };
    
    // Renderer
    THREE.WebGLRenderer = function(params) {
        params = params || {};
        this.canvas = params.canvas || document.createElement('canvas');
        this.domElement = this.canvas;
        this.shadowMap = { enabled: false, type: 0 };
        this.xr = { enabled: false, setSession: function() { return Promise.resolve(); } };
        
        this.ctx = this.canvas.getContext('2d');
        if (!this.ctx) {
            console.warn('2D context fallback - WebGL not available');
        }
    };
    
    THREE.WebGLRenderer.prototype = {
        setSize: function(width, height) {
            this.canvas.width = width;
            this.canvas.height = height;
        },
        setPixelRatio: function(ratio) {
            // Stub
        },
        render: function(scene, camera) {
            // Simple 2D fallback rendering
            if (!this.ctx) return;
            
            var ctx = this.ctx;
            var width = this.canvas.width;
            var height = this.canvas.height;
            
            // Clear
            ctx.fillStyle = scene.background ? '#0a0a1a' : '#000';
            ctx.fillRect(0, 0, width, height);
            
            // Draw simple representation
            ctx.fillStyle = '#00d4ff';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('3D View (Simplified Mode)', width/2, height/2);
            ctx.font = '14px Arial';
            ctx.fillStyle = '#fff';
            ctx.fillText('Game is running in 2D fallback mode', width/2, height/2 + 30);
        }
    };
    
    THREE.PCFSoftShadowMap = 0;
    
    console.log('THREE.js stub loaded (minimal fallback version)');
})();
