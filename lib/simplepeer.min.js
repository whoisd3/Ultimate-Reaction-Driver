// Minimal SimplePeer stub for testing when CDN is unavailable
// This is a simplified version for demonstration purposes
// In production, use the full SimplePeer library

(function() {
    'use strict';
    
    window.SimplePeer = function(opts) {
        opts = opts || {};
        this.initiator = opts.initiator || false;
        this.connected = false;
        this.destroyed = false;
        this._handlers = {};
        
        console.log('SimplePeer stub created (minimal fallback version)');
        
        // Simulate connection after a delay
        if (this.initiator) {
            setTimeout(() => {
                this._emit('signal', { type: 'offer', sdp: 'stub-offer' });
            }, 100);
        }
    };
    
    SimplePeer.prototype = {
        on: function(event, handler) {
            if (!this._handlers[event]) {
                this._handlers[event] = [];
            }
            this._handlers[event].push(handler);
        },
        
        _emit: function(event, data) {
            if (this._handlers[event]) {
                this._handlers[event].forEach(handler => {
                    try {
                        handler(data);
                    } catch (e) {
                        console.error('SimplePeer event handler error:', e);
                    }
                });
            }
        },
        
        signal: function(data) {
            // Stub - in real implementation, this would handle WebRTC signaling
            console.log('SimplePeer signal:', data);
            
            // Simulate successful connection
            setTimeout(() => {
                this.connected = true;
                this._emit('connect');
            }, 500);
        },
        
        send: function(data) {
            if (!this.connected) {
                console.warn('SimplePeer: Not connected, cannot send');
                return;
            }
            // Stub - in real implementation, this would send data through WebRTC
            console.log('SimplePeer send:', data);
        },
        
        destroy: function() {
            this.destroyed = true;
            this.connected = false;
            this._emit('close');
        }
    };
    
    console.log('SimplePeer stub loaded (minimal fallback version)');
})();
